{% extends "base.html" %}
{% block main %}
    <form id="form" action="/company_chart" class="form-search well">
        <select id="csv_file_name" name="csv_file_name">
            {% if csv_file_list %}
                {% for csv in csv_file_list %}
                    <option  {% if csv_file_name == csv %} selected="selected" {% endif %}
                                                           value="{{ csv }}">{{ csv }}</option>
                {% endfor %}
            {% endif %}
        </select>
        <select id="company_name" name="company_name">
            {% if companies %}
                {% for company in companies %}
                    <option  {% if company_name == company %} selected="selected" {% endif %}
                                                              value="{{ company }}">{{ company }}</option>
                {% endfor %}
            {% endif %}
        </select>
    </form>
    <table class="table table-striped table-bordered">
        <thead>
        <tr>
            <th>TSSH PwrReduced</th>
            <th>Taken time</th>
        </tr>
        </thead>
        <tbody>
        {% if items %}
            {% for item in items %}
                <tr>
                    <td class="tssh_data">{{ item[0]|round(2) }}</td>
                    <td class="time_taken">{{ item[1] }}</td>
                </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="2">No data</td>
            </tr>
        {% endif %}
        </tbody>
    </table>

    <div id="company_chart" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
{% endblock %}

{% block ext_script %}
    <script type="text/javascript">
        $(function () {
            $("#company_name").change(function () {
                $("#form").submit();
            });
            $("#csv_file_name").change(function () {
                $("#company_name").val("");
                $("#form").submit();
            });
            var option = {
                chart:{
                    renderTo:'company_chart',
                    type:'area'
                },
                title:{
                    text:'TSSH_PWR_REDUCED chart of {{ company_name }}'
                },
                subtitle:{
                    text:'<a href="/?csv_file_name={{ csv_file_name }}&company_name={{ company_name }}">Source data</a>'
                },
                xAxis:{
                    categories:[],
                    labels:{
                        formatter:function () {
                            return this.value;
                        }
                    }
                },
                yAxis:{
                    title:{
                        text:'TSSH_PWR_REDUCED'
                    },
                    labels:{
                        formatter:function () {
                            return this.value;
                        }
                    }
                },
                tooltip:{
                    formatter:function () {
                        return this.y;
                    }
                },
                plotOptions:{
                    pointStart:'',
                    area:{
                        marker:{
                            enabled:false,
                            symbol:'circle',
                            radius:2,
                            states:{
                                hover:{
                                    enabled:true
                                }
                            }
                        }
                    }
                },
                series:[
                    {
                        name:'{{ company_name }}',
                        data:[]
                    }
                ]
            };
            $('.time_taken').each(function () {
                option.xAxis.categories.push(this.innerHTML)
            });

            $('.tssh_data').each(function () {
                option.series[0].data.push(parseFloat(this.innerHTML));
            });
            option.plotOptions.pointStart = option.xAxis.categories[0];
            var chart = new Highcharts.Chart(option);
        })
    </script>
{% endblock %}